name: Jekyll site CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v2
      - name: Install gems
        run: bundle install --jobs=3 --retry=3 --deployment
      - name: Install kindlegen
        run: | 
          mkdir -p bin tmp/kindlegen 
          curl https://f000.backblazeb2.com/file/wjdp-lib/kindlegen_linux_2.6_i386_v2_9.tar.gz > tmp/kindlegen.tar.gz
          tar zxvf tmp/kindlegen.tar.gz -C tmp/kindlegen
          mv tmp/kindlegen/kindlegen bin/
      - name: Store run ID
        run: echo -n $(($GITHUB_RUN_ID + 100)) > _includes/travis_build_number.txt
      - name: Build
        run: bundle exec rake build
