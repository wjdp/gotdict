language: ruby
rvm: 2.5

cache:
  bundler: true
  directories:
  - vendor/bundle
  - ".sass-cache"

install:
  - bundle install --jobs=3 --retry=3 --deployment --path=${BUNDLE_PATH:-vendor/bundle}
  - mkdir -p bin tmp/kindlegen
  - curl https://f000.backblazeb2.com/file/wjdp-lib/kindlegen_linux_2.6_i386_v2_9.tar.gz > tmp/kindlegen.tar.gz
  - tar zxvf tmp/kindlegen.tar.gz -C tmp/kindlegen
  - mv tmp/kindlegen/kindlegen bin/
before_script:
  - echo -n $TRAVIS_BUILD_NUMBER > _includes/travis_build_number.txt
script:
  - bundle exec rake build
after_success:
  - bin/deploy.sh

branches:
  except:
  - gh-pages

git:
  depth: 6

env:
  global:
    secure: C7zsw85yRNk+qg19bPW0KunkkxCfIqqNLd3RrohNcJJ64IEcrUkb05hNVrK90v79MxQRhROrwqt0KfIL+2RHuAbRPnIy7ujmk9gVZOc8GvrQ2gpsiTA0pQyBUa2V2EUyMfYd/q0wfrNZM9kNtzOdgeCktt4ZYQbQ7T250vV9RP8KDelzV8Ydaj93F7+QQj0y5VG93UgXAjYN/pzs7m3lKZKqJl4UfCNL6nakuC4m55n5o0Eq2q512m80+z379Q+IFx6D/iyrZIFBKQ5C58t3cYfdfnzYWkluQzmGBB5zOMSDRFKv7dqnUXUylKuBPj0pKjgGl96g+nY02xr7M14vghK7/cAZt/AJ2rorjMYXiYhEmDcWJKgX4xxgg58Bd7KuH7kkJo+D2pOmxn2VKm5wuDlK6nlrP6KiIF1XmslAbiVoGdLT5U+QZYaBM/RnS4ZOHCsLdS/bnyWOQ7AIDEmqE+xQhIz0P/adPr/5fqHQY1d/0RIJeyudH79TZ6vNq/bI4sOWoD2fOTzH65gwTDDQxgjNd7uHFf21WEcVKKea5lbvixP+Zzxp3lN+CfLcuyPIf5grj1ts5PNt3JUcnbMlqdedAJplK8UezDlmDhELy27uyR8ObMW83t8zAidMnvetawsXrg5QDg2odIxtT8ItcJs+Ag2+Ek0P2gn9OYEJJoQ=
