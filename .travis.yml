language: ruby
rvm: 2.5

cache:
  bundler: true
  directories:
  - vendor/bundle
  - ".sass-cache"

install:
  - bundle install --jobs=3 --retry=3 --deployment --path=${BUNDLE_PATH:-vendor/bundle}
  - mkdir -p bin tmp/kindlegen
  - curl http://kindlegen.s3.amazonaws.com/kindlegen_linux_2.6_i386_v2_9.tar.gz > tmp/kindlegen.tar.gz
  - tar zxvf tmp/kindlegen.tar.gz -C tmp/kindlegen
  - mv tmp/kindlegen/kindlegen bin/
before_script:
  - echo -n $TRAVIS_BUILD_NUMBER > _includes/travis_build_number.txt
script:
  - bundle exec rake build
after_success:
  - bin/deploy.sh

branches:
  except:
  - gh-pages

git:
  depth: 6

env:
  global:
    - secure: "WIpC5cBpQOC14SfT4kMh6kWTfPm280XJZEKAgftKPNlkQ3UN5mVSh6bwtS0O+mEZuJbNdCwfT1CMs/w1FE6VWHawKwZG9+38hH3iEKPENMRtBHHnYnDBKlcfnB67Hjy/5Feqw18L5PRTWbc4/uYENarFtvQrx1xKKRatlpzmExFI8OCVCmTf6V9EKHhhg/v7r9dyPC86h3BKUGHtZVhhe8975wyitz46UHEpYMuTY4ekI52TeFxvjGdTSkHzxhPaADgP4UHvwgOsxpcs4wsRLZIF3IOGVN74wAykIDBDyGj4Ou6MkPGwPRzk3cjB1JZ5zvmYfi4NDu3JQSHS9r3lJulzAtd5IVW+LRROyHc7U1UEyhfRyvGqUaD/bbMAK/jt1n6W0oUZO+Ar+HnEUPzaKnBdpKMja3Tc7yvC85QRAb0iDsIcNoopgRHolSAQTh6tAX/6R1IA81lj0JhAcqUsW+QfzWvPaDAoZFeHTscW6MS3izYbt67LFHc4bjsgEDcCfO8Z0vQqPzjNh6oTNWI1XyBJG3WXobP9VHTc5x3zH3oaEYIsv0VUj3f2TM/KNJ5AFQgKSl6YmWun5NyYMecYfAlhJVdoSo2GjA9vlFubzlpDksVi9sWAsuSDvcfrGtprFsMW0C3kErEm8O5Auh+xUXO0TrBO+W9z2YYwIjmGcKE="
